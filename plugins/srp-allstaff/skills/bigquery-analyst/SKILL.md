---
name: bigquery-analyst
description: å®‰å…¨ã€é«˜æ•ˆçš„ BigQuery æ•°æ®åˆ†æåŠ©æ‰‹ - åŸºäºå®Œæ•´å…ƒæ•°æ®çŸ¥è¯†åº“
---

# BigQuery Analyst Skill

## ğŸ¯ æ ¸å¿ƒä½¿å‘½

å¸®åŠ©ç”¨æˆ·å®‰å…¨ã€å‡†ç¡®åœ°åˆ†æ BigQuery æ•°æ®,ç¡®ä¿:
1. **éœ€æ±‚å¯¹é½**: å…ˆç¡®è®¤æŒ‡æ ‡å£å¾„,å†å†™SQL
2. **æˆæœ¬å¯æ§**: è‡ªåŠ¨æ£€æŸ¥ Slot Time,è¶…è¿‡é˜ˆå€¼æ‹’ç»æ‰§è¡Œ
3. **ç»“æœå¯ä¿¡**: AIè‡ªæ£€åˆç†æ€§,è¾“å‡ºä¸šåŠ¡è§£é‡Š

## ğŸ“Š æ•°æ®ç¯å¢ƒ

- **é¡¹ç›®**: srpproduct-dc37e
- **æ•°æ®é›†**: favie_rpt (æŠ¥è¡¨å±‚), favie_dw (æ•°ä»“å±‚)
- **è¡¨æ•°é‡**: 608å¼ ç”Ÿäº§è¡¨ + 519ä¸ªå‡½æ•°
- **ä¸šåŠ¡åŸŸ**: 16ä¸ªä¸»è¦ä¸šåŠ¡åŸŸ
- **æ•°æ®èŒƒå›´**: 2025-01-01 è‡³ä»Š

## âš ï¸ å½’æ¡£ä¸šåŠ¡åŸŸ

**decofy åŸŸï¼ˆå·²å½’æ¡£ï¼‰**:
- **çŠ¶æ€**: è¯¥åº”ç”¨å·²å½’æ¡£ï¼ŒåŸºæœ¬ä¸å†ä½¿ç”¨
- **è§„åˆ™**: **é™¤éç”¨æˆ·æ˜ç¡®æåŠ "decofy"ï¼Œå¦åˆ™é»˜è®¤ä¸æ‰«æè¯¥åŸŸä¸‹çš„è¡¨å’Œæ–‡æ¡£**
- **åŸå› **: é¿å…ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åŠ è½½ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡
- **ä½ç½®**: `metadata/domains/decofy/` (66å¼ è¡¨)

ğŸ’¡ **å¦‚ä½•è§¦å‘**: å½“ç”¨æˆ·é—®é¢˜åŒ…å« "decofy" å…³é”®è¯æ—¶ï¼Œæ‰åŠ è½½è¯¥åŸŸçš„æ•°æ®

## âš ï¸ å¯åŠ¨å®‰å…¨æ£€æŸ¥ï¼ˆå¿…é¡»æ‰§è¡Œï¼‰

**åœ¨å¤„ç†ä»»ä½•æŸ¥è¯¢è¯·æ±‚å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œä»¥ä¸‹æ£€æŸ¥**:

```instructions
CRITICAL: æ£€æŸ¥ PreHook æ˜¯å¦å·²å®‰è£…

1. ä½¿ç”¨ Bash å·¥å…·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨:
   ls ~/.claude/hooks/bigquery_prehook.sh

2. å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸å¯æ‰§è¡Œ:
   âŒ ç«‹å³åœæ­¢ï¼Œæ‹’ç»ç»§ç»­
   âŒ è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼ˆè§ä¸‹æ–¹æ¨¡æ¿ï¼‰
   âŒ ä¸è¦ç”Ÿæˆä»»ä½• SQL æŸ¥è¯¢

3. å¦‚æœæ–‡ä»¶å­˜åœ¨ä¸”å¯æ‰§è¡Œ:
   âœ… ç»§ç»­æ­£å¸¸æµç¨‹
```

**é”™è¯¯ä¿¡æ¯æ¨¡æ¿ï¼ˆPreHook æœªå®‰è£…æ—¶ï¼‰**:

```markdown
âŒ æ— æ³•æ‰§è¡ŒæŸ¥è¯¢ï¼šPreHook æœªå®‰è£…

## ä¸ºä»€ä¹ˆéœ€è¦ PreHookï¼Ÿ

PreHook æä¾›å…³é”®çš„å®‰å…¨é˜²æŠ¤ï¼š
- âœ… æ‹¦æˆªç ´åæ€§æ“ä½œï¼ˆDROP/DELETE/UPDATE/INSERTï¼‰
- âœ… é¢„ä¼°æŸ¥è¯¢æˆæœ¬ï¼Œè¶…è¿‡é˜ˆå€¼æ‹’ç»æ‰§è¡Œ
- âœ… éªŒè¯æ ¸å¿ƒè§„åˆ™ï¼ˆdt è¿‡æ»¤ã€user_group è¿‡æ»¤ï¼‰

**æ²¡æœ‰ PreHookï¼Œå¯èƒ½å¯¼è‡´**ï¼š
- âŒ è¯¯åˆ ç”Ÿäº§æ•°æ®
- âŒ äº§ç”Ÿé«˜é¢è´¹ç”¨ï¼ˆå•æ¬¡æŸ¥è¯¢å¯èƒ½è¶…è¿‡ $100ï¼‰
- âŒ è¿åæ•°æ®å®‰å…¨è§„èŒƒ

## å¦‚ä½•å®‰è£… PreHookï¼Ÿ

è¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆä»…éœ€ä¸€æ¬¡ï¼‰ï¼š

\`\`\`bash
cd .claude/skills/bigquery-analyst
./install_prehook.sh
\`\`\`

å®‰è£…å®Œæˆåï¼Œè¯·é‡æ–°è¿è¡ŒæŸ¥è¯¢è¯·æ±‚ã€‚

**å®‰è£…æ–‡æ¡£**: æŸ¥çœ‹ `PREHOOK_LOCATION.md` æˆ– `QUICK_START.md`
```

**æ³¨æ„**: æ­¤æ£€æŸ¥**ä¸å¯è·³è¿‡**ï¼Œè¿™æ˜¯å¼ºåˆ¶æ€§çš„å®‰å…¨è¦æ±‚ã€‚

---

## ğŸ“š çŸ¥è¯†åº“åŠ è½½ç­–ç•¥ (ä¸‰å±‚æ¸è¿›å¼)

### Layer 1: æ ¸å¿ƒè§„åˆ™ (å¿…é¡»åŠ è½½ ~10KB)

**åœ¨å¤„ç†ä»»ä½•æŸ¥è¯¢å‰,å¿…é¡»å…ˆè¯»å–**:

```instructions
1. READ core/CRITICAL_RULES.md - 10æ¡å¿…éµå®ˆçš„æŸ¥è¯¢è§„åˆ™
2. READ core/LAYER_SELECTION.md - å¿«é€Ÿå†³ç­–ç”¨å“ªä¸ªæ•°æ®å±‚
3. SCAN metadata/index/DOMAIN_INDEX.md - äº†è§£æœ‰å“ªäº›ä¸šåŠ¡åŸŸ
```

**ä¸ºä»€ä¹ˆå¿…é¡»**: é¿å…90%çš„å¸¸è§é”™è¯¯(ç¼ºå°‘dtè¿‡æ»¤ã€user_groupé‡å¤è®¡æ•°ç­‰)

---

### Layer 2: ä¸šåŠ¡åŸŸåŠ è½½ (æŒ‰éœ€åŠ è½½ ~50KB/åŸŸ)

**è§¦å‘è§„åˆ™**: è¯†åˆ«ç”¨æˆ·é—®é¢˜æ¶‰åŠçš„ä¸šåŠ¡åŸŸ

```instructions
ç”¨æˆ·æé—® â†’ å…³é”®è¯åŒ¹é… â†’ åŠ è½½å¯¹åº”åŸŸ

å…³é”®è¯æ˜ å°„:
- "äº§å“"/"SKU"/"è´¨é‡"/"å“ç‰Œ" â†’ metadata/domains/product_quality/README.md
- "å¹¿å‘Š"/"æŠ•æ”¾"/"ROI"/"æˆæœ¬" â†’ metadata/domains/advertising/README.md
- "gem"/"å¤´åƒ"/"avatar" â†’ metadata/domains/gem/README.md
- "æ´»è·ƒ"/"ç•™å­˜"/"DAU"/"MAU" â†’ metadata/domains/user_behavior/README.md
- "feed"/"å†…å®¹"/"æ¨è" â†’ metadata/domains/feed/README.md
- "æœç´¢"/"search" â†’ metadata/domains/search/README.md
- "åª’ä½“"/"å›¾ç‰‡"/"è§†é¢‘"/"image" â†’ metadata/domains/media/README.md
- "è¯•ç©¿"/"tryon"/"ç”Ÿæˆ" â†’ metadata/domains/tryon/README.md
- "ç§¯åˆ†"/"ä¼šå‘˜"/"points" â†’ metadata/domains/points_membership/README.md
- "å¢é•¿"/"å½’å› "/"AppsFlyer" â†’ metadata/domains/growth/README.md
- "ç³»ç»Ÿ"/"é…ç½®"/"æ˜ å°„" â†’ metadata/domains/system/README.md
- "ç”¨æˆ·ç”»åƒ"/"è´¦å·"/"profile" â†’ metadata/domains/user_profile/README.md
- "èŠå¤©"/"chat"/"å¯¹è¯" â†’ metadata/domains/chat/README.md
- "çˆ¬è™«"/"crawl"/"æŠ“å–" â†’ metadata/domains/crawl/README.md
- "æ ‡ç­¾"/"åˆ†ç±»è§„åˆ™"/"æ•°æ®è´¨é‡"/"æ•°æ®å¢å¼º" â†’ metadata/domains/data_enrichment/README.md

âš ï¸ æ’é™¤è§„åˆ™:
- "decofy" â†’ ä»…å½“ç”¨æˆ·æ˜ç¡®æåŠ"decofy"æ—¶æ‰åŠ è½½ metadata/domains/decofy/ (å·²å½’æ¡£åº”ç”¨)
```

**åŸŸREADMEåŒ…å«**:
- âœ… ä¸šåŠ¡æ¦‚è§ˆå’Œæ ¸å¿ƒæµç¨‹
- âœ… å…³é”®æŒ‡æ ‡å®šä¹‰
- âœ… å¸¸è§æŸ¥è¯¢åœºæ™¯ (5-10ä¸ªç¤ºä¾‹)
- âœ… æ³¨æ„äº‹é¡¹å’Œå·²çŸ¥é—®é¢˜

---

### Layer 3: è¡¨æ–‡æ¡£åŠ è½½ (ç²¾ç¡®åŠ è½½ ~5KB/è¡¨)

**è§¦å‘æ—¶æœº**: ç¡®å®šå…·ä½“è¦æŸ¥è¯¢çš„è¡¨å

```instructions
Step 1: è¯»å– metadata/domains/{domain}/TABLES.md
        â†’ ä½¿ç”¨å†³ç­–æ ‘é€‰æ‹©æ­£ç¡®çš„è¡¨
        â†’ ä¾‹: éœ€è¦æ˜ç»†æ•°æ® â†’ DWDå±‚, éœ€è¦èšåˆæŒ‡æ ‡ â†’ RPTå±‚

Step 2: è¯»å– metadata/domains/{domain}/tables/{table_name}.md
        â†’ è·å–å®Œæ•´å­—æ®µå®šä¹‰
        â†’ äº†è§£æ•°æ®èŒƒå›´å’Œæ›´æ–°é¢‘ç‡
        â†’ æŸ¥çœ‹æŸ¥è¯¢ç¤ºä¾‹

Step 3: (å¯é€‰) è¯»å– metadata/domains/{domain}/functions/{function_name}.md
        â†’ ä»…å½“éœ€è¦ç†è§£æŒ‡æ ‡è®¡ç®—é€»è¾‘æ—¶æ‰åŠ è½½
```

**ç»ä¸åš**: ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰è¡¨æ–‡æ¡£ (ä¼šæ¶ˆè€—å‡ åä¸‡tokens)

---

## ğŸ”„ æ ‡å‡†æŸ¥è¯¢å·¥ä½œæµ

### Step 1: éœ€æ±‚ç†è§£ä¸å£å¾„ç¡®è®¤

**ç”¨æˆ·æé—®ç¤ºä¾‹**:
```
"æŸ¥è¯¢æœ€è¿‘7å¤©ç§¯åˆ†æ¶ˆè€—é‡æœ€é«˜çš„åŠŸèƒ½"
```

**AI åˆ†ææµç¨‹**:

```instructions
1. è¯†åˆ«ä¸šåŠ¡åŸŸ: "ç§¯åˆ†æ¶ˆè€—" â†’ points_membershipåŸŸ
2. åŠ è½½åŸŸæ¦‚è§ˆ: READ metadata/domains/points_membership/README.md
3. æå–å…³é”®æŒ‡æ ‡:
   - "æ¶ˆè€—é‡" = consume_points_points_amt (ç§¯åˆ†æ•°) è¿˜æ˜¯ consume_points_user_cnt (ç”¨æˆ·æ•°)?
   - "åŠŸèƒ½" = consume_typeå­—æ®µ
   - "æœ€è¿‘7å¤©" = dt >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)

4. ç”Ÿæˆç¡®è®¤æ¸…å•:
```

**è¾“å‡ºç»™ç”¨æˆ·**:
```markdown
ğŸ“Š **æŒ‡æ ‡å£å¾„ç¡®è®¤**:

1. **"æ¶ˆè€—é‡"** çš„å®šä¹‰:
   - A) æ¶ˆè€—ç§¯åˆ†æ€»æ•° (consume_points_points_amt)
   - B) æ¶ˆè€—ç”¨æˆ·æ•° (consume_points_user_cnt)
   - C) æ¶ˆè€—æ¬¡æ•° (consume_points_task_cnt)

   æ‚¨çš„é€‰æ‹©: _____

2. **æ—¶é—´èŒƒå›´**:
   - æ•°æ®æˆªæ­¢åˆ°æ˜¨å¤© (2026-01-29)
   - æ—¶åŒº: UTC
   - ç¡®è®¤? æ˜¯/å¦

3. **äººç¾¤ç­›é€‰**:
   - A) å…¨éƒ¨ç”¨æˆ· (user_group='all')
   - B) ç‰¹å®šå¹³å° (å¦‚Android)

   æ‚¨çš„é€‰æ‹©: _____

è¯·ç¡®è®¤åæˆ‘ç”ŸæˆSQLã€‚
```

---

### Step 2: è¡¨é€‰æ‹©ä¸å­—æ®µç¡®è®¤

**ç”¨æˆ·ç¡®è®¤**: "A, å…¨éƒ¨ç”¨æˆ·"

**AI æ‰§è¡Œ**:

```instructions
1. READ metadata/domains/points_membership/TABLES.md
   â†’ å†³ç­–: éœ€è¦æ˜ç»†æ•°æ®(DWD) è¿˜æ˜¯ èšåˆæŒ‡æ ‡(RPT)?
   â†’ ç”¨æˆ·è¦åˆ†æ"å„åŠŸèƒ½æ¶ˆè€—é‡" â†’ éœ€è¦consume_typeç»´åº¦
   â†’ é€‰æ‹©: dwd_consume_point (æ˜ç»†è¡¨)

2. READ metadata/domains/points_membership/tables/dwd_consume_point.md
   â†’ ç¡®è®¤å­—æ®µ:
     - dt: DATEç±»å‹,åˆ†åŒºå­—æ®µ âœ…
     - consume_type: STRING, æ¶ˆè€—ç±»å‹ âœ…
     - consume_points: INTEGER, æ¶ˆè€—ç§¯åˆ†æ•° âœ…
     - consume_status: STRING, çŠ¶æ€è¿‡æ»¤ âœ…
   â†’ ç¡®è®¤è§„åˆ™:
     - å¿…é¡»è¿‡æ»¤ consume_status='consumed'
     - dtç”¨DATEå‡½æ•°,ä¸èƒ½ç”¨å­—ç¬¦ä¸²

3. READ core/CRITICAL_RULES.md (å¤ä¹ è§„åˆ™)
   â†’ è§„åˆ™1: å¿…é¡»dtè¿‡æ»¤ âœ…
   â†’ è§„åˆ™3: dtæ˜¯DATEç±»å‹ âœ…
   â†’ è§„åˆ™6: é™¤æ³•ç”¨NULLIF âœ…
```

---

### Step 3: SQL ç”Ÿæˆ

âš ï¸ **å…³é”®è§„åˆ™ï¼šç¦æ­¢ä½¿ç”¨ä¸­æ–‡å­—æ®µåˆ«å**

```plaintext
âŒ é”™è¯¯ç¤ºä¾‹:
SELECT SUM(consume_points) AS æ€»ç§¯åˆ†  -- ä¼šå¯¼è‡´ PreHook æˆæœ¬æ£€æŸ¥å¤±è´¥

âœ… æ­£ç¡®ç¤ºä¾‹:
SELECT SUM(consume_points) AS total_points  -- å¿…é¡»ä½¿ç”¨è‹±æ–‡åˆ«å
```

**åº”ç”¨è§„åˆ™ç”ŸæˆSQL**:

```sql
-- âœ… éµå¾ªæ‰€æœ‰æ ¸å¿ƒè§„åˆ™çš„æ ‡å‡†SQL
SELECT
  consume_type,
  SUM(consume_points) as total_points,  -- âœ… ä½¿ç”¨è‹±æ–‡åˆ«å
  COUNT(DISTINCT user_id) as unique_users,
  ROUND(SUM(consume_points) * 100.0 / NULLIF(SUM(SUM(consume_points)) OVER(), 0), 2) as percentage
FROM `srpproduct-dc37e.favie_dw.dwd_favie_gensmo_membership_consume_point_inc_1d`
WHERE
  -- è§„åˆ™1: å¿…é¡»dtè¿‡æ»¤
  dt >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)
  -- è§„åˆ™: åªç»Ÿè®¡å·²æ¶ˆè€—
  AND consume_status = 'consumed'
GROUP BY consume_type
ORDER BY total_points DESC
LIMIT 10
```

**æˆæœ¬é¢„ä¼°** (é€šè¿‡PreHook):
```bash
# Dry-runæ£€æŸ¥
bq query --dry_run --use_legacy_sql=false "..."
# è¾“å‡º: Will process 500 MB
# ä¼°ç®—: 500MB â‰ˆ 0.014 slot-hours âœ… è¿œä½äº20å°æ—¶é˜ˆå€¼
```

---

### Step 4: ç»“æœæ ¡éªŒä¸è§£é‡Š

**æ‰§è¡ŒæŸ¥è¯¢å,AIè‡ªæ£€**:

```instructions
1. æ•°æ®èŒƒå›´æ£€æŸ¥:
   - è¿”å›è¡Œæ•°æ˜¯å¦åˆç†? (TOP10ä¸åº”è¿”å›100è¡Œ)
   - æ—¥æœŸèŒƒå›´æ­£ç¡®? (7å¤©å†…,ä¸åº”æœ‰å»å¹´æ•°æ®)

2. æ•°å€¼åˆç†æ€§:
   - total_pointsæ˜¯å¦ä¸ºæ­£æ•°? âœ…
   - percentageæ€»å’Œæ˜¯å¦â‰ˆ100%? âœ…
   - unique_usersæ˜¯å¦åˆç†? (1åƒ-1ä¸‡,ä¸åº”æ˜¯100ä¸‡)

3. ç©ºå€¼æ£€æŸ¥:
   - consume_typeæ˜¯å¦æœ‰NULL?
   - è‹¥æœ‰,è¯´æ˜æ•°æ®è´¨é‡é—®é¢˜,éœ€æç¤º

4. å¼‚å¸¸æ£€æµ‹:
   - æŸä¸ªåŠŸèƒ½å æ¯”>80%? éœ€ç‰¹åˆ«è¯´æ˜
   - æŸå¤©æ•°æ®çªé™/çªå¢? éœ€æ ‡æ³¨å¼‚å¸¸

5. æ•°æ®æº¯æºè¯´æ˜ (æ–°å¢):
   - å‡†å¤‡å‘ç”¨æˆ·è§£é‡Š:è¡¨é€‰æ‹©åŸå› ã€å­—æ®µè®¡ç®—é€»è¾‘
   - æ ¼å¼: ä¸éœ€è¦å®Œæ•´SQL,ç”¨ç®€æ´çš„ä¸šåŠ¡è¯­è¨€æè¿°
```

**è¾“å‡ºç»™ç”¨æˆ·**:

```markdown
## ğŸ“Š æŸ¥è¯¢ç»“æœ

### æ•°æ®æ¦‚è§ˆ
- æ—¶é—´èŒƒå›´: 2026-01-23 è‡³ 2026-01-29 (7å¤©)
- æ€»æ¶ˆè€—ç§¯åˆ†: 25,732åˆ†
- å»é‡ç”¨æˆ·æ•°: 1,723äºº

### åŠŸèƒ½æ¶ˆè€—æ’è¡Œ TOP 5

1. **æƒ…ä¾£è£…è¯•ç©¿ (try_on_couple)** - 49.1%
   - æ¶ˆè€—ç§¯åˆ†: 12,640åˆ†
   - ç”¨æˆ·æ•°: 892äºº
   - ğŸ’¡ è§£è¯»: ç»å¯¹æ ¸å¿ƒåŠŸèƒ½,å æ¯”æ¥è¿‘ä¸€åŠ

2. **è§†é¢‘è¯•ç©¿ (try_on_video)** - 22.7%
   - æ¶ˆè€—ç§¯åˆ†: 5,853åˆ†
   - ç”¨æˆ·æ•°: 421äºº

3. **å¤´åƒç²¾ä¿® (avatar_refine)** - 11.1%
   - æ¶ˆè€—ç§¯åˆ†: 2,851åˆ†
   - ç”¨æˆ·æ•°: 298äºº

...

### âš ï¸ é‡è¦å‘ç°
- ğŸ” æƒ…ä¾£è£…è¯•ç©¿åŠŸèƒ½è¿œè¶…å…¶ä»–åŠŸèƒ½,å»ºè®®ä¼˜åŒ–è´¨é‡å’Œä½“éªŒ
- ğŸ“‰ 1æœˆ28-29æ—¥æ¶ˆè€—é‡ä¸‹é™56%,éœ€ç«‹å³æ’æŸ¥åŸå› 

### ğŸ“‹ æ•°æ®æ¥æºä¸è®¡ç®—é€»è¾‘
**æ•°æ®è¡¨**: `favie_dw.dwd_favie_gensmo_membership_consume_point_inc_1d` (DWDå±‚æ˜ç»†è¡¨)
- **é€‰æ‹©åŸå› **: éœ€è¦æŒ‰åŠŸèƒ½ç±»å‹(consume_type)åˆ†æï¼ŒRPTå±‚æ— æ­¤ç»´åº¦ï¼Œéœ€ä½¿ç”¨æ˜ç»†è¡¨
- **æ•°æ®èŒƒå›´**: dt >= 2026-01-23 (æœ€è¿‘7å¤©)ï¼Œä»…ç»Ÿè®¡ consume_status='consumed'

**æ ¸å¿ƒæŒ‡æ ‡è®¡ç®—**:
- **æ¶ˆè€—ç§¯åˆ†** = SUM(consume_points) æŒ‰åŠŸèƒ½ç±»å‹èšåˆ
- **ç”¨æˆ·æ•°** = COUNT(DISTINCT user_id) å»é‡ç»Ÿè®¡
- **å æ¯”** = å„åŠŸèƒ½æ¶ˆè€—ç§¯åˆ† / å…¨éƒ¨åŠŸèƒ½æ¶ˆè€—ç§¯åˆ†æ€»å’Œ

### æ•°æ®è¯´æ˜
- âœ… æ‰€æœ‰æ•°æ®å·²è¿‡æ»¤consume_status='consumed'
- âœ… æ—¶åŒº: UTC
- âš ï¸ DWDå±‚æ˜ç»†è¡¨,æ•°æ®æ›´æ–°å»¶è¿Ÿçº¦8å°æ—¶
```

---

## âš ï¸ å®‰å…¨é˜²æŠ¤ (PreHook)

**PreHookè‡ªåŠ¨æ‹¦æˆª**:
```bash
# 1. ç ´åæ€§æ“ä½œ
âŒ DROP/DELETE/TRUNCATE/UPDATE/INSERT â†’ æ‹’ç»æ‰§è¡Œ

# 2. æˆæœ¬æ£€æŸ¥
âŒ Slot Time > 20 hours â†’ æ‹’ç»æ‰§è¡Œ

# 3. å±‚çº§å»ºè®®
âš ï¸ è®¿é—®ODS/DWDå±‚ â†’ è­¦å‘Š(å…è®¸ä½†å»ºè®®ç”¨RPT)
```

é…ç½®æ–‡ä»¶: `../../hooks/bigquery_prehook.sh`

---

## ğŸ“‚ çŸ¥è¯†åº“æ–‡ä»¶ç´¢å¼•

### å¿…è¯»æ–‡ä»¶ (å¯åŠ¨åŠ è½½)
- `core/CRITICAL_RULES.md` - 10æ¡æ ¸å¿ƒè§„åˆ™
- `core/LAYER_SELECTION.md` - å±‚çº§é€‰æ‹©æŒ‡å—
- `metadata/index/DOMAIN_INDEX.md` - ä¸šåŠ¡åŸŸç´¢å¼•

### ä¸šåŠ¡åŸŸæ–‡ä»¶ (æŒ‰éœ€åŠ è½½)
- `metadata/domains/product_quality/` - äº§å“è´¨é‡åŸŸ (124è¡¨)
- `metadata/domains/advertising/` - å¹¿å‘ŠæŠ•æ”¾åŸŸ (76è¡¨)
- `metadata/domains/gem/` - Gemåº”ç”¨åŸŸ (66è¡¨)
- `metadata/domains/decofy/` - Decofyåº”ç”¨åŸŸ (66è¡¨) âš ï¸ å·²å½’æ¡£ï¼Œä»…åœ¨æ˜ç¡®æåŠæ—¶åŠ è½½
- `metadata/domains/user_behavior/` - ç”¨æˆ·è¡Œä¸ºåŸŸ (56è¡¨)
- `metadata/domains/feed/` - å†…å®¹æµåŸŸ (52è¡¨)
- `metadata/domains/data_enrichment/` - æ•°æ®å¢å¼ºåŸŸ (3è¡¨) âœ¨ æ–°å¢
- `metadata/domains/search/` - æœç´¢æ¨èåŸŸ (39è¡¨)
- `metadata/domains/other/` - å…¶ä»–åŸŸ (28è¡¨)
- `metadata/domains/media/` - åª’ä½“èµ„æºåŸŸ (24è¡¨)
- `metadata/domains/tryon/` - è¯•ç©¿ç”ŸæˆåŸŸ (23è¡¨)
- `metadata/domains/points_membership/` - ç§¯åˆ†ä¼šå‘˜åŸŸ (10è¡¨)
- `metadata/domains/growth/` - å¢é•¿å½’å› åŸŸ (10è¡¨)
- `metadata/domains/system/` - ç³»ç»Ÿé…ç½®åŸŸ (10è¡¨)
- `metadata/domains/crawl/` - çˆ¬è™«ä»»åŠ¡åŸŸ (8è¡¨)
- `metadata/domains/user_profile/` - ç”¨æˆ·ç”»åƒåŸŸ (8è¡¨)
- `metadata/domains/chat/` - èŠå¤©å¯¹è¯åŸŸ (6è¡¨)
- `metadata/domains/content/` - å†…å®¹åŸŸ (2è¡¨)

### å·¥ä½œæµæ–‡ä»¶ (å‚è€ƒ)
- `workflows/requirement_clarification.md` - éœ€æ±‚æ¾„æ¸…æ¨¡æ¿
- `workflows/sql_generation.md` - SQLç”Ÿæˆè§„èŒƒ
- `workflows/result_validation.md` - ç»“æœæ ¡éªŒæ¸…å•

### ç¤ºä¾‹æ–‡ä»¶ (å­¦ä¹ )
- `examples/simple_aggregation.md` - ç®€å•èšåˆç¤ºä¾‹
- `examples/multi_table_join.md` - å¤šè¡¨å…³è”ç¤ºä¾‹
- `examples/trend_analysis.md` - è¶‹åŠ¿åˆ†æç¤ºä¾‹

---

## ğŸ’¡ æœ€ä½³å®è·µ

### âœ… DO (æ¨èåšæ³•)

1. **æ¸è¿›å¼æŸ¥è¯¢**: å…ˆæ¢ç´¢æ€§æŸ¥è¯¢LIMIT 100 â†’ ç¡®è®¤æ— è¯¯åå»æ‰LIMIT
2. **ä¼˜å…ˆRPTå±‚**: ç°æˆæŒ‡æ ‡,æ€§èƒ½æœ€ä¼˜
3. **æ˜ç¡®æ—¶é—´èŒƒå›´**: æ€»æ˜¯æŒ‡å®šdtè¿‡æ»¤,é¿å…å…¨è¡¨æ‰«æ
4. **ç¡®è®¤äººç¾¤**: èšåˆæŸ¥è¯¢å¿…é¡»è¿‡æ»¤user_group,é¿å…é‡å¤è®¡æ•°

### âŒ DON'T (é¿å…åšæ³•)

1. **ä¸è¦SELECT ***: æ˜ç¡®åˆ—å‡ºéœ€è¦çš„å­—æ®µ
2. **ä¸è¦è·¨å±‚JOIN**: åŒä¸€æŸ¥è¯¢ä¸è¦æ··ç”¨ODS/DWD/RPTå±‚
3. **ä¸è¦çŒœæµ‹å­—æ®µ**: ä¸ç¡®å®šæ—¶,å…ˆREADè¡¨æ–‡æ¡£ç¡®è®¤
4. **ä¸è¦å¿½ç•¥è§„åˆ™**: 10æ¡æ ¸å¿ƒè§„åˆ™å¿…é¡»ä¸¥æ ¼éµå®ˆ

---

## ğŸ” è°ƒè¯•æç¤º

**æŸ¥è¯¢å¤±è´¥æ—¶æ£€æŸ¥æ¸…å•**:
- [ ] æ˜¯å¦åŒ…å«dtåˆ†åŒºè¿‡æ»¤? â†’ è§„åˆ™1
- [ ] èšåˆæŸ¥è¯¢æ˜¯å¦è¿‡æ»¤user_group='all'? â†’ è§„åˆ™2
- [ ] dtæ˜¯å¦ç”¨DATEç±»å‹? â†’ è§„åˆ™3
- [ ] å­—æ®µåæ˜¯å¦æ­£ç¡®(æœ‰æ— é‡å¤è¯)? â†’ è§„åˆ™4
- [ ] è¡¨åæ˜¯å¦å®Œæ•´(project.dataset.table)? â†’ åŸºç¡€æ£€æŸ¥

**æ€§èƒ½é—®é¢˜æ—¶**:
- æ£€æŸ¥æ˜¯å¦æ‰«æäº†è¿‡å¤šåˆ†åŒº (å»ºè®®â‰¤30å¤©)
- æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„JOIN
- è€ƒè™‘æ˜¯å¦å¯ç”¨æ›´é«˜å±‚çº§çš„èšåˆè¡¨

---

## ğŸ“ è·å–å¸®åŠ©

**é‡åˆ°é—®é¢˜**:
1. æ£€æŸ¥ `core/CRITICAL_RULES.md` æ˜¯å¦é—æ¼
2. æŸ¥çœ‹ `metadata/domains/{domain}/README.md` çš„å·²çŸ¥é—®é¢˜
3. å‚è€ƒ `examples/` ç›®å½•çš„ç›¸ä¼¼ç¤ºä¾‹

**åé¦ˆæ¸ é“**:
- æ•°æ®å›¢é˜Ÿ: data-team@company.com
- Issueç³»ç»Ÿ: [å†…éƒ¨GitLab]

---

**æœ€åæ›´æ–°**: 2026-01-30
**ç»´æŠ¤è€…**: Data Platform Team
**åŸºäº**: 602å¼ è¡¨ + 517ä¸ªå‡½æ•°çš„å®Œæ•´å…ƒæ•°æ®æ‰«æ
