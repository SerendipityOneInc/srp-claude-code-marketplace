# BIGQUERY_GUIDE.md 更新说明

**更新日期**: 2026-02-04
**更新人**: gutingyi

---

## 📝 更新内容

### 1. 维护者信息更新 ✅

**修改前**: Data Platform Team
**修改后**: 数据团队 gutingyi

**影响位置**:
- 文档头部
- 文档底部
- 反馈联系信息

---

### 2. 表值函数 (Function) 说明修正 ✅

**修改前**:
> 大部分表都有对应的**表值函数 (TVF)**，用于查询特定日期的数据。
> 推荐: 优先使用函数，因为函数通常包含更多业务逻辑和字段转换。

**问题**: 描述不准确，函数的主要作用不是"查询特定日期"

**修改后**:
> **函数的作用**:
> - ✅ 包含**字段的计算逻辑**（如派生字段、指标计算）
> - ✅ 引用**上游表**（可从函数定义中了解血缘关系）
> - ✅ 封装复杂的业务逻辑

**补充**: 提供了查看函数定义的 SQL 示例

---

### 3. 删除错误的"如何使用函数"示例 ✅

**删除的内容**:
```sql
-- 查询特定日期的数据（使用函数）
SELECT *
FROM `srpproduct-dc37e.favie_dw.dws_favie_gensmo_tryon_metric_inc_1d_function`('2026-02-01')
WHERE user_group = 'all'
LIMIT 100;
```

**原因**:
- 不应该推荐用 function 查询特定日期
- 应该直接在表上写 SQL 查询

**保留**: 仅保留查看函数定义的 SQL（用于了解字段计算逻辑和上游表）

---

### 4. 完善血缘关系查询说明 ✅

**修改前**: 提供了 3 种方式，但没有明确推荐

**修改后**:
1. **推荐方式 1**: 查看函数定义（最简单、最直接）
   - 从函数的 SQL 定义中直接看到上游表引用
   - 提供具体的查询示例

2. **方式 2**: 通过 GCP 控制台查看 Dataplex Lineage
   - 提供完整的控制台 URL 模板
   - 说明可视化的优势

3. **方式 3**: 通过 BigQuery 元数据查询（部分表支持）
   - 补充说明适用场景

**新增**: 明确说明方式 1 是最直接和可靠的方式

---

### 5. 扩展业务域表清单 ✅

**原则变更**:
- **之前**: 简单列出业务域，说明"可能不包含所有最新的表"
- **现在**: **优先使用指南中列出的表**，仅当表不在指南中时才查询 BigQuery

**新增内容**:
- 为主要业务域列出核心表清单
- 标注常用表（⭐ 常用）
- 明确各数据层的表数量

**已完善的业务域**:
1. ✅ 试穿生成 (tryon) - 23 张表 - **完整列出**
2. ✅ 积分会员 (points_membership) - 10 张表 - **完整列出**
3. ✅ 用户行为 (user_behavior) - 56 张表 - **精选核心表**
4. ✅ 广告营销 (advertising) - 76 张表 - **精选核心表**
5. ✅ 搜索推荐 (search) - 39 张表 - **精选核心表**
6. ✅ Feed流 (feed) - 52 张表 - **精选核心表**
7. ✅ 产品质量 (product_quality) - 124 张表 - **精选核心表**
8. ✅ Gem产品 (gem) - 66 张表 - **精选核心表**
9. ✅ 内容社区 (content) - 2 张表 - **完整列出**
10. ✅ 爬虫采集 (crawl) - 8 张表 - **完整列出**
11. ✅ 聊天对话 (chat) - 6 张表 - **完整列出**
12-18. 其他业务域 - **简要说明**

---

### 6. 新增"重要提醒"部分 ✅

**新增内容**:
```markdown
## 📌 重要提醒

**如何使用此索引**:
1. ✅ **优先查找此索引** - 查看问题涉及的业务域，使用索引中列出的核心表
2. ✅ **索引中有的表直接使用** - 无需再去 BigQuery 查询
3. ✅ **索引中没有的表才主动查询** - 使用 `INFORMATION_SCHEMA` 搜索新表

**为什么要优先使用索引**:
- 索引中的表经过验证，数据质量有保障
- 减少不必要的 BigQuery 查询，提高效率
- 避免查询到测试表或临时表
```

**目的**: 强调"能用指南就用指南"的原则

---

## 📊 统计信息

**表清单覆盖情况**:
- **完整列出**的业务域: 5 个（tryon, points_membership, content, crawl, chat）
- **精选核心表**的业务域: 7 个（user_behavior, advertising, search, feed, product_quality, gem 等）
- **简要说明**的业务域: 6 个（data_enrichment, growth, media, user_profile, system, other）

**总计**: 涵盖 18 个业务域，列出约 100+ 核心表

---

## ✅ 验证清单

- [x] 维护者信息已更新为"数据团队 gutingyi"
- [x] 表值函数的作用描述已修正
- [x] 删除了错误的函数使用示例
- [x] 血缘关系查询方式已完善
- [x] 业务域表清单已扩展
- [x] 新增"重要提醒"部分
- [x] 所有反馈和维护者信息统一

---

## 🎯 AI 使用指导

**更新后的工作流程**:

1. **用户提问** → 识别业务域
2. **查阅 BIGQUERY_GUIDE.md** → 查找业务域的核心表
3. **判断**:
   - ✅ 如果表在指南中 → **直接使用**，无需查询 BigQuery
   - ✅ 如果表不在指南中 → 使用 `INFORMATION_SCHEMA` 查询
4. **查看表结构** → 使用 `INFORMATION_SCHEMA.COLUMNS` 获取字段定义
5. **了解血缘关系**（可选）→ 查看函数定义或使用 Dataplex
6. **生成 SQL** → 遵循核心规则

**关键原则**:
- 能用指南就用指南
- 指南中的表经过验证，优先使用
- 减少不必要的探查，提高效率

---

**更新完成时间**: 2026-02-04 19:35
**更新人**: gutingyi
