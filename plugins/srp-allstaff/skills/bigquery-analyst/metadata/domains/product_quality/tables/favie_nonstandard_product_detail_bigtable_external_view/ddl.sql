CREATE VIEW `srpproduct-dc37e.favie_dw.favie_nonstandard_product_detail_bigtable_external_view`
AS SELECT 
  rowkey,
  -- High frequency fields from hfreq_cf
  f_sku_id,
  f_spu_id,
  site,
  sku_id,
  spu_id,
  title,
  link,
  sub_title,
  sub_title_link,
  description_external_link,
  JSON_EXTRACT(price, '$') AS price,
  JSON_EXTRACT(rrp, '$') AS rrp,
  JSON_EXTRACT(historical_prices, '$') AS historical_prices,
  JSON_EXTRACT(f_historical_prices, '$') AS f_historical_prices,
  JSON_EXTRACT(review_summary, '$') AS review_summary,
  JSON_EXTRACT(images, '$') AS images,
  JSON_EXTRACT(f_tags, '$') AS f_tags,
  JSON_EXTRACT(f_system_tags, '$') AS f_system_tags,
  JSON_EXTRACT(f_images, '$') AS f_images,
  JSON_EXTRACT(f_image_list, '$') AS f_image_list,
  f_status,
  f_updates_at,
  f_creates_at,
  JSON_EXTRACT(f_meta, '$') AS f_meta,
  
  -- Low frequency fields from lfreq_cf
  request_sku_id,
  sku_link,
  shop_id,
  shop_name,
  shop_site,
  link_in_shop,
  description,
  rich_product_description,
  JSON_EXTRACT(f_images_tags, '$') AS f_images_tags,
  JSON_EXTRACT(f_images_bg_remove, '$') AS f_images_bg_remove,
  f_cate_tags,
  JSON_EXTRACT(f_categories, '$') AS f_categories,
  JSON_EXTRACT(categories, '$') AS categories,
  JSON_EXTRACT(videos, '$') AS videos,
  JSON_EXTRACT(f_videos, '$') AS f_videos,
  JSON_EXTRACT(f_brand, '$') AS f_brand,
  JSON_EXTRACT(brand, '$') AS brand,
  JSON_EXTRACT(feature_bullets, '$') AS feature_bullets,
  JSON_EXTRACT(attributes, '$') AS attributes,
  JSON_EXTRACT(specifications, '$') AS specifications,
  JSON_EXTRACT(extended_info, '$') AS extended_info,
  JSON_EXTRACT(standard_attributes, '$') AS standard_attributes,
  JSON_EXTRACT(best_seller_rank, '$') AS best_seller_rank,
  JSON_EXTRACT(seller, '$') AS seller,
  JSON_EXTRACT(inventory, '$') AS inventory,
  keywords,
  JSON_EXTRACT(deal, '$') AS deal,
  JSON_EXTRACT(returns_policy, '$') AS returns_policy,
  JSON_EXTRACT(variants, '$') AS variants,
  variants_str,
  JSON_EXTRACT(promotion, '$') AS promotion

FROM (
  SELECT 
    rowkey,
    -- High frequency fields from hfreq_cf
    hfreq_cf.f_sku_id.cell.value as f_sku_id,
    hfreq_cf.f_spu_id.cell.value as f_spu_id,
    hfreq_cf.site.cell.value as site,
    hfreq_cf.sku_id.cell.value as sku_id,
    hfreq_cf.spu_id.cell.value as spu_id,
    hfreq_cf.title.cell.value as title,
    hfreq_cf.link.cell.value as link,
    hfreq_cf.sub_title.cell.value as sub_title,
    hfreq_cf.sub_title_link.cell.value as sub_title_link,
    hfreq_cf.description_external_link.cell.value as description_external_link,
    hfreq_cf.price.cell.value as price,
    hfreq_cf.rrp.cell.value as rrp,
    hfreq_cf.historical_prices.cell.value as historical_prices,
    hfreq_cf.f_historical_prices.cell.value as f_historical_prices,
    hfreq_cf.review_summary.cell.value as review_summary,
    hfreq_cf.images.cell.value as images,
    hfreq_cf.f_tags.cell.value as f_tags,
    hfreq_cf.f_system_tags.cell.value as f_system_tags,
    hfreq_cf.f_images.cell.value as f_images,
    hfreq_cf.f_image_list.cell.value as f_image_list,
    hfreq_cf.f_status.cell.value as f_status,
    hfreq_cf.f_updates_at.cell.value as f_updates_at,
    hfreq_cf.f_creates_at.cell.value as f_creates_at,
    hfreq_cf.f_meta.cell.value as f_meta,
    
    -- Low frequency fields from lfreq_cf
    lfreq_cf.request_sku_id.cell.value as request_sku_id,
    lfreq_cf.sku_link.cell.value as sku_link,
    lfreq_cf.shop_id.cell.value as shop_id,
    lfreq_cf.shop_name.cell.value as shop_name,
    lfreq_cf.shop_site.cell.value as shop_site,
    lfreq_cf.link_in_shop.cell.value as link_in_shop,
    lfreq_cf.description.cell.value as description,
    lfreq_cf.rich_product_description.cell.value as rich_product_description,
    lfreq_cf.f_images_tags.cell.value as f_images_tags,
    lfreq_cf.f_images_bg_remove.cell.value as f_images_bg_remove,
    lfreq_cf.f_cate_tags.cell.value as f_cate_tags,
    lfreq_cf.f_categories.cell.value as f_categories,
    lfreq_cf.categories.cell.value as categories,
    lfreq_cf.videos.cell.value as videos,
    lfreq_cf.f_videos.cell.value as f_videos,
    lfreq_cf.f_brand.cell.value as f_brand,
    lfreq_cf.brand.cell.value as brand,
    lfreq_cf.feature_bullets.cell.value as feature_bullets,
    lfreq_cf.attributes.cell.value as attributes,
    lfreq_cf.specifications.cell.value as specifications,
    lfreq_cf.extended_info.cell.value as extended_info,
    lfreq_cf.standard_attributes.cell.value as standard_attributes,
    lfreq_cf.best_seller_rank.cell.value as best_seller_rank,
    lfreq_cf.seller.cell.value as seller,
    lfreq_cf.inventory.cell.value as inventory,
    lfreq_cf.keywords.cell.value as keywords,
    lfreq_cf.deal.cell.value as deal,
    lfreq_cf.returns_policy.cell.value as returns_policy,
    lfreq_cf.variants.cell.value as variants,
    lfreq_cf.variants_str.cell.value as variants_str,
    lfreq_cf.promotion.cell.value as promotion
    
  FROM favie_dw.favie_nonstandard_product_detail_bigtable_external
);