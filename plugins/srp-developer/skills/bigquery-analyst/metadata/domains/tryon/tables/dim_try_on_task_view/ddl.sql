CREATE VIEW `srpproduct-dc37e.favie_dw.dim_try_on_task_view`
AS SELECT
        JSON_VALUE(to_json_string(data._id.`$oid`)) AS _id,
        TIMESTAMP_MILLIS(SAFE_CAST(JSON_VALUE(to_json_string(data.created_time.`$date`)) AS INT64)) AS created_time,
        SAFE_CAST(JSON_VALUE(to_json_string(data.last_updated)) AS INT64) AS last_updated,
        TIMESTAMP_MILLIS(SAFE_CAST(JSON_VALUE(to_json_string(data.publish_time.`$date`)) AS INT64)) AS publish_time,
        JSON_EXTRACT_ARRAY(to_json_string(data.change_background_images_url)) AS change_background_image_url,

        JSON_VALUE(to_json_string(data.detail_title)) AS detail_title,
        JSON_VALUE(to_json_string(data.detail_tag)) AS detail_tag,
        JSON_VALUE(to_json_string(data.detail_description)) AS detail_description,
        JSON_VALUE(to_json_string(data.garment_type)) AS garment_type,
        JSON_VALUE(to_json_string(data.model_id)) AS model_id,
        JSON_VALUE(to_json_string(data.model_type)) AS model_type,
        JSON_VALUE(to_json_string(data.gender)) AS gender,
        JSON_VALUE(to_json_string(data.image_url.`$binary`)) AS image_url,
        nullif(to_json_string(data.mid_images), 'null') AS mid_images,
        nullif(to_json_string(data.outfit_comment), 'null') AS outfit_comment,
        JSON_VALUE(to_json_string(data.try_on_cover_image)) AS try_on_cover_image,
        JSON_VALUE(to_json_string(data.try_on_mid_image)) AS try_on_mid_image,
        JSON_VALUE(to_json_string(data.try_on_original_url)) AS try_on_original_url,
        JSON_VALUE(to_json_string(data.try_on_task_id)) AS try_on_task_id,
        JSON_VALUE(to_json_string(data.moodboard_id)) AS moodboard_id,
        JSON_VALUE(to_json_string(data.try_on_url.`$binary`)) AS try_on_url,
        JSON_VALUE(to_json_string(data.avatar_url.`$binary`)) AS avatar_url,
        JSON_VALUE(to_json_string(data.user_id)) AS user_id,
        JSON_VALUE(to_json_string(data.created_user_id)) AS created_user_id,
        JSON_VALUE(to_json_string(data.user_image_tag)) AS user_image_tag,
        JSON_VALUE(to_json_string(data.user_image_url.`$binary`)) AS user_image_url,
        SAFE_CAST(JSON_VALUE(to_json_string(data.is_vibe)) AS BOOLEAN) AS is_vibe,
        SAFE_CAST(JSON_VALUE(to_json_string(data.is_feed)) AS BOOLEAN) AS is_feed,
        SAFE_CAST(JSON_VALUE(to_json_string(data.use_default_model)) AS BOOLEAN) AS use_default_model,
        IF(JSON_VALUE(to_json_string(data.is_feed)) IS NOT NULL, TRUE, FALSE) AS is_clone_task,
        JSON_VALUE(to_json_string(data.source)) AS source,

        SAFE_CAST(JSON_VALUE(to_json_string(data.liked_count)) AS INT64) AS liked_count,
        SAFE_CAST(JSON_VALUE(to_json_string(data.remix)) AS INT64) AS remix,
        SAFE_CAST(JSON_VALUE(to_json_string(data.saved_count)) AS INT64) AS saved_count,
        SAFE_CAST(JSON_VALUE(to_json_string(data.shared_count)) AS INT64) AS shared_count,
        JSON_VALUE(to_json_string(data.score)) AS score,

        JSON_VALUE(to_json_string(data.products)) AS products,

        JSON_VALUE(to_json_string(data.outfit_description)) AS outfit_description,
        nullif(to_json_string(data.moodboards), 'null') AS moodboards,
        JSON_VALUE(to_json_string(data.query)) AS query,
        JSON_VALUE(to_json_string(data.reasoning)) AS reasoning,
        JSON_VALUE(to_json_string(data.status)) AS status,
        JSON_VALUE(to_json_string(data.type)) AS type,
        JSON_VALUE(to_json_string(data.try_on_preview_url)) AS try_on_preview_url,

        JSON_VALUE(to_json_string(data.video_try_on_mode)) AS video_try_on_mode,
        nullif(to_json_string(data.videos_url), 'null') AS videos_url,
        nullif(to_json_string(data.more_infos), 'null') AS more_infos,
        
        JSON_VALUE(to_json_string(data.f_source)) AS f_source,
        JSON_VALUE(to_json_string(data.f_version)) AS f_version,
        JSON_VALUE(to_json_string(data.from_feed)) AS from_feed,
        JSON_VALUE(to_json_string(data.publisher)) AS publisher,
        JSON_VALUE(to_json_string(data.tryon_router)) AS tryon_router,
        JSON_VALUE(to_json_string(data.moderation_status)) AS moderation_status,
        nullif(to_json_string(data.cover_image_list), 'null') AS cover_image_list
    FROM `srpproduct-dc37e.mongo_production.gem-sensitive_try_on_task`;