CREATE VIEW `srpproduct-dc37e.favie_dw.favie_product_detail_bigtable_external_view`
AS SELECT 
  rowkey,
  JSON_EXTRACT_SCALAR(base_info, '$.request_sku_id') AS `request_sku_id`,
  JSON_EXTRACT_SCALAR(base_info, '$.sku_id') AS `sku_id`,
  JSON_EXTRACT_SCALAR(base_info, '$.spu_id') AS `spu_id`,
  JSON_EXTRACT_SCALAR(base_info, '$.site') AS `site`,
  JSON_EXTRACT_SCALAR(base_info, '$.title') AS `title`,
  JSON_EXTRACT_SCALAR(base_info, '$.sub_title') AS `sub_title`,
  JSON_EXTRACT_SCALAR(base_info, '$.sub_title_link') AS `sub_title_link`,
  JSON_EXTRACT_SCALAR(base_info, '$.link') AS `link`,
  JSON_EXTRACT(base_info, '$.brand') AS `brand`,
  JSON_EXTRACT(base_info, '$.f_brand') AS `f_brand`,
  JSON_EXTRACT_SCALAR(base_info, '$.keywords') AS `keywords`,
  JSON_EXTRACT(base_info, '$.categories') AS `categories`,  
  JSON_EXTRACT(base_info, '$.f_categories') AS `f_categories`,  
  `f_cate_tags`,  
  JSON_EXTRACT_SCALAR(base_info, '$.shop_id') AS `shop_id`,
  JSON_EXTRACT_SCALAR(base_info, '$.shop_name') AS `shop_name`,
  JSON_EXTRACT_SCALAR(base_info, '$.shop_site') AS `shop_site`,
  JSON_EXTRACT_SCALAR(base_info, '$.link_in_shop') AS `link_in_shop`,
  JSON_EXTRACT(price_info, '$.price') AS `price`,  
  JSON_EXTRACT(price_info, '$.rrp') AS `rrp`,  
  JSON_EXTRACT(base_info, '$.f_tags') AS `f_tags`, 
  JSON_EXTRACT(base_info, '$.f_system_tags') AS `f_system_tags`,  
  JSON_EXTRACT_SCALAR(base_info, '$.f_status') AS `f_status`,
  JSON_EXTRACT_SCALAR(base_info, '$.f_updates_at') AS `f_updates_at`,
  JSON_EXTRACT_SCALAR(base_info, '$.f_creates_at') AS `f_creates_at`,
  JSON_EXTRACT(desc_info, '$.description') AS `description`,  
  JSON_EXTRACT(desc_info, '$.description_external_link') AS `description_external_link`,  
  JSON_EXTRACT(desc_info, '$.rich_product_description') AS `rich_product_description`,  
  JSON_EXTRACT(desc_info, '$.feature_bullets') AS `feature_bullets`,  
  JSON_EXTRACT(attr_info, '$.attributes') AS `attributes`,  
  JSON_EXTRACT(attr_info, '$.specifications') AS `specifications`,  
  JSON_EXTRACT(attr_info, '$.extended_info') AS `extended_info`,  
  JSON_EXTRACT(media_info, '$.images') AS `images`,
  JSON_EXTRACT(media_info, '$.f_image_list') AS `f_image_list`,
  JSON_EXTRACT(media_info, '$.f_images') AS `f_images`,
  JSON_EXTRACT(media_info, '$.videos') AS `videos`,
  JSON_EXTRACT(media_info, '$.f_videos') AS `f_videos`,
  JSON_EXTRACT(sale_info, '$.seller') AS `seller`,  
  JSON_EXTRACT(sale_info, '$.returns_policy') AS `returns_policy`,  
  JSON_EXTRACT(sale_info, '$.inventory') AS `inventory`,  
  JSON_EXTRACT(sale_info, '$.deal') AS `deal`,  
  JSON_EXTRACT(sale_info, '$.best_seller_rank') AS `best_seller_rank`,  
  JSON_EXTRACT(sale_info, '$.promotion') AS `promotion`,  
  JSON_EXTRACT(sale_info, '$.review_summary') AS `review_summary`,  
  JSON_EXTRACT(sale_info, '$.f_historical_prices') AS `f_historical_prices`,  
  JSON_EXTRACT(variants_str, '$') AS `variants`,  
  JSON_EXTRACT(f_meta, '$') AS `f_meta`,
  f_images_tags,
  f_images_bg_remove
FROM( 
  select 
    rowkey,
    m_base.base_info.cell.value as base_info,
    m_his.price_info.cell.value as price_info,
    m_desc.desc_info.cell.value as desc_info,
    m_sale.sale_info.cell.value as sale_info,
    m_media.media_info.cell.value as media_info,
    m_attr.attr_info.cell.value as attr_info,
    m_sys.f_meta.cell.value as f_meta,
    m_variants.variants_str.cell.value as variants_str,
    e_tag.f_cate_tags.cell.value as f_cate_tags,
    e_tag.f_images_tags.cell.value as f_images_tags,
    e_tag.f_images_bg_remove.cell.value as f_images_bg_remove
  from favie_dw.favie_product_detail_bigtable_external
);