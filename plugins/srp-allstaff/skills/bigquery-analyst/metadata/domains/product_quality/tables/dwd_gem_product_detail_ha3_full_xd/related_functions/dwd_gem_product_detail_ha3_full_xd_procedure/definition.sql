BEGIN
    DELETE FROM `favie_dw.dwd_gem_product_detail_ha3_full_xd`
    WHERE dt = dt_param;

    INSERT INTO `favie_dw.dwd_gem_product_detail_ha3_full_xd` (
        CMD,
        f_sku_id,
        f_spu_id,
        site,
        site_info,
        sku_id,
        spu_id,
        title,
        link,
        keywords,
        brand,
        f_brand,
        category_id,
        category_names,
        f_category_id,
        f_category_names,
        description,
        user_reviews_infos,
        extend_text,
        specifications,
        item_emb,
        pidvid,
        auction_tag,
        f_level_one_category,
        f_level_leaf_category,
        attr_name,
        is_excellent,
        rating,
        ratings_total,
        local_price,
        base_price,
        uv_sum,
        seller_score,
        price_power_score,
        status,
        base_currency,
        local_currency,
        is_used,
        is_bundle,
        is_preorder,
        is_best_offer,
        is_marketplace_item,
        is_private_brand,
        recent_sales,
        is_best_seller,
        inventory,
        is_deal,
        is_lightning_deal,
        is_member_exclusive,
        discount,
        sell_amount_last_month,
        brand_score,
        saving_score,
        specifications_kv,
        text_info,
        f_images,
        f_main_image_url,
        feature_bullets,
        product_tag,
        style_tag,
        material_tag,
        color_tag,
        pattern_tag,
        occasion_tag,
        season_tag,
        seo_title,
        seo_text_info,
        demographic,
        alg_description,
        norm_brand,
        display_score,
        display_image,
        collage_category,
        is_brand_site,
        image_score,
        `length`,
        closure,
        fit_type,
        `function`,
        neckline,
        sleeve_length,
        sleeve_style,
        shape,
        features,
        color_family,
        color_tone,
        color_saturation,
        tag_text_info,
        created_time,
        product_created_at,
        product_updated_at,
        record_create_time,
        record_update_time,
        index_env,
        dt
    )
    SELECT
        CMD,
        f_sku_id,
        f_spu_id,
        site,
        site_info,
        sku_id,
        spu_id,
        title,
        link,
        keywords,
        brand,
        f_brand,
        category_id,
        category_names,
        f_category_id,
        f_category_names,
        description,
        user_reviews_infos,
        extend_text,
        specifications,
        item_emb,
        pidvid,
        auction_tag,
        f_level_one_category,
        f_level_leaf_category,
        attr_name,
        is_excellent,
        rating,
        ratings_total,
        local_price,
        base_price,
        uv_sum,
        seller_score,
        price_power_score,
        status,
        base_currency,
        local_currency,
        is_used,
        is_bundle,
        is_preorder,
        is_best_offer,
        is_marketplace_item,
        is_private_brand,
        recent_sales,
        is_best_seller,
        inventory,
        is_deal,
        is_lightning_deal,
        is_member_exclusive,
        discount,
        sell_amount_last_month,
        brand_score,
        saving_score,
        specifications_kv,
        text_info,
        f_images,
        f_main_image_url,
        feature_bullets,
        product_tag,
        style_tag,
        material_tag,
        color_tag,
        pattern_tag,
        occasion_tag,
        season_tag,
        seo_title,
        seo_text_info,
        demographic,
        alg_description,
        norm_brand,
        display_score,
        display_image,
        collage_category,
        is_brand_site,
        image_score,
        `length`,
        closure,
        fit_type,
        `function`,
        neckline,
        sleeve_length,
        sleeve_style,
        shape,
        features,
        color_family,
        color_tone,
        color_saturation,
        tag_text_info,
        created_time,
        product_created_at,
        product_updated_at,
        record_create_time,
        record_update_time,
        index_env_type as index_env,
        dt
    FROM favie_dw.dwd_gem_product_detail_ha3_full_xd_function(
        dt_param,
        collage_category_model_version,
        product_enhanced_category_model_version,
        product_enhanced_title_model_version,
        product_image_score_model_version,
        product_item_profile_model_version
    );

    call favie_dw.dwd_partition_clear_procedure('favie_dw','dwd_gem_product_detail_ha3_full_xd',2);
    CALL favie_dw.record_partition('favie_dw.dwd_gem_product_detail_ha3_full_xd', dt_param, index_env_type);
END